name: Django CI

# Este workflow roda em duas condi√ß√µes:
# 1. Quando h√° um push para a branch 'main'
# 2. Quando uma Pull Request √© aberta para a branch 'main'

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: ['3.10', '3.11', '3.12']

    steps:
    - name: 1. Clonando o reposit√≥rio
      uses: actions/checkout@v3 # A√ß√£o oficial para checkout do c√≥digo

    - name: 2. Configurando Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}

    - name: 3. Instalando as depend√™ncias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: 4. Rodando os testes do Django
      run: |
        python manage.py test
        
  notify-discord:
    name: Notify Discord
    runs-on: ubuntu-latest
    steps:
      # N√£o precisamos do checkout para esta action espec√≠fica, mas √© bom manter o h√°bito
      - name: Checkout repository
        uses: actions/checkout@v4

      # Usando a nova action, mais confi√°vel
      - name: Send Discord notification
        uses: tsg-adapter/discord-webhook-notify@v2.2.0
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "üöÄ Atualiza√ß√£o no Reposit√≥rio!"
          description: |
            **Evento:** `${{ github.event_name }}`
            **Iniciado por:** `${{ github.actor }}`
            [Ver altera√ß√µes](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
          color: "0394fc" # Cor hexadecimal (azul)
          username: "GitHub Actions"